# ===========================================
# Environment Variables for Logistics Data Extractor
# ===========================================
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control

# -------------------------------------------
# Application Settings
# -------------------------------------------

# Anthropic API Key (required for LLM extraction)
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Server port (Cloud Run uses 8080 by default)
PORT=8080

# Allowed CORS origins (comma-separated, for Cloud Run frontend URL)
# Example: https://frontend-abc123-uc.a.run.app,https://your-domain.com
ALLOWED_ORIGINS=

# -------------------------------------------
# GCP Configuration (for deployment)
# -------------------------------------------

# GCP Project ID
GCP_PROJECT_ID=unique-hash-367919

# GCP Region for Cloud Run deployment
GCP_REGION=us-central1

# Artifact Registry repository name
ARTIFACT_REGISTRY_REPO=logistics-extractor

# -------------------------------------------
# GitHub Actions Variables (set via gh cli)
# -------------------------------------------
# These are set in GitHub and used by CD workflow:
# - GCP_PROJECT_ID: unique-hash-367919
# - GCP_REGION: us-central1
# - ARTIFACT_REGISTRY_REPO: logistics-extractor
# - GCP_SERVICE_ACCOUNT: github-actions-sa@unique-hash-367919.iam.gserviceaccount.com
# - GCP_WORKLOAD_IDENTITY_PROVIDER: projects/PROJECT_NUM/locations/global/workloadIdentityPools/github-actions-pool/providers/github-provider

# -------------------------------------------
# Service URLs (populated after deployment)
# -------------------------------------------

# Backend Cloud Run service URL (internal access only)
# BACKEND_URL=https://backend-xxxxx-uc.a.run.app

# Frontend Cloud Run service URL (public)
# FRONTEND_URL=https://frontend-xxxxx-uc.a.run.app

# -------------------------------------------
# Security Architecture
# -------------------------------------------
# The deployment uses a secure architecture where:
#
# 1. Backend is NOT publicly accessible from the internet:
#    --ingress=internal (blocks all external traffic)
#    --allow-unauthenticated (auth via network isolation, not IAM tokens)
#
# 2. Frontend uses VPC Direct Egress to reach internal backend:
#    Browser → Frontend (nginx) → VPC Direct Egress → Backend (internal)
#    --network=default --subnet=default --vpc-egress=all-traffic
#
# 3. Private Google Access enabled on subnet:
#    Required for VPC traffic to reach Cloud Run services
#
# 4. Separate service accounts with least privilege:
#    - backend-sa: Accesses secrets, runs extraction logic
#    - frontend-sa: Serves static files, proxies to backend, has roles/compute.networkUser
#
# 5. IAM bindings ensure only authorized access:
#    - Frontend SA has roles/run.invoker on Backend
#    - Only Backend SA can access anthropic-api-key secret

# -------------------------------------------
# Cloud Run Resource Configuration
# -------------------------------------------
# These values are consistent across CD workflow and local deploy script:
#
# Backend:
#   --port=8080
#   --memory=1Gi
#   --cpu=1
#   --min-instances=0
#   --max-instances=10
#   --timeout=300
#   --ingress=internal
#   --allow-unauthenticated
#   --service-account=backend-sa@PROJECT_ID.iam.gserviceaccount.com
#   --set-secrets=ANTHROPIC_API_KEY=anthropic-api-key:latest
#
# Frontend:
#   --port=8080
#   --memory=512Mi
#   --cpu=1
#   --min-instances=0
#   --max-instances=5
#   --timeout=60
#   --allow-unauthenticated
#   --service-account=frontend-sa@PROJECT_ID.iam.gserviceaccount.com
#   --set-env-vars=BACKEND_URL=<backend-url>
#   --network=default
#   --subnet=default
#   --vpc-egress=all-traffic

# -------------------------------------------
# Rollback Strategy
# -------------------------------------------
# Automatic rollback: If health check fails during deploy, traffic is
# automatically restored to the previous revision.
#
# Manual rollback: Use the CD - Rollback workflow in GitHub Actions,
# or run:
#   gcloud run services update-traffic backend --to-revisions=REVISION=100 --region=us-central1
#   gcloud run services update-traffic frontend --to-revisions=REVISION=100 --region=us-central1
#
# Rollback timing: <5 seconds (Cloud Run atomic traffic switch)

# -------------------------------------------
# Build Optimizations (set in Dockerfile)
# -------------------------------------------

# Enable Python bytecode compilation (faster cold starts)
# UV_COMPILE_BYTECODE=1
